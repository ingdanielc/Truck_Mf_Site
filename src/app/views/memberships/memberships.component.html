<div class="mt-2">
  <div
    class="flex justify-content-between align-items-center flex-wrap mt-3 gap-2"
  >
    <g-title title="Membresías" style="margin-top: -1rem"></g-title>
    <div class="flex">
      <p-button
        label="Crear membresía"
        borderRadius="10px"
        icon="ml-4 fa-solid fa-clipboard-check"
        (onClick)="createNewMembership()"
      ></p-button>
    </div>
  </div>
  <div class="container py-2 mt-4 mb-5 px-3 md:px-5">
    <!-- Details -->
    <div class="flex flex-wrap mt-2 justify-content-between align-items-end">
      <div class="flex" style="width: 420px">
        <span class="p-input-icon-left w-full">
          <i class="pi pi-search"></i>
          <input
            pInputText
            pAutoFocus
            class="p-inputtext w-full"
            [style]="{ height: '48px' }"
            [autofocus]="true"
            placeholder="Buscar por nombre de membresía..."
            paddingLeft="35px"
            [(ngModel)]="membershipFilter"
            (input)="applyFilterMembresia(membershipFilter!)"
            maxLength="maxlengthFilter"
          />
        </span>
      </div>
      <!-- Filter -->
      <div class="flex mt-1 w-full sm:w-auto">
        <g-filter
          class="w-full sm:w-auto"
          [listStatus]="listStatus"
          [statusFilter]="statusFilter"
          [listTypes]="listTypesFilter"
          [typesFilter]="typesFilter"
          [labelFiltro]="labelFiltro"
          (selectedStatus)="statusFilter = $event"
          (selectedTypes)="typesFilter = $event"
          (apply)="applyFilter()"
          (clean)="cleanFilter()"
        ></g-filter>
      </div>
    </div>

    <div class="mt-3">
      <div class="grid">
        <div *ngFor="let membership of listMemberships" class="col lg:col-6">
          <g-card-membership
            [data]="membership"
            (click)="openDetail(membership.id!)"
            (mouseenter)="hover = true"
            (mouseleave)="hover = false"
            [hover]="hover"
            onkeypress
          ></g-card-membership>
        </div>
      </div>
      <div class="mt-5">
        <p-paginator
          (onPageChange)="onPageChange($event)"
          [styleClass]="'noBorder'"
          [first]="first"
          [rows]="rows"
          [totalRecords]="totalElements"
          [rowsPerPageOptions]="[10, 20, 50]"
          [showCurrentPageReport]="true"
          [currentPageReportTemplate]="currentPageReportTemplate"
        />
      </div>
    </div>
  </div>
</div>

<!-- Crear membresia -->
<g-modal
  [show]="modalCreate"
  [closeOnEscape]="false"
  [showCloseIcon]="false"
  [showHeader]="false"
  [width]="'780px'"
>
  <ng-template pTemplate="content">
    <div>
      <div class="pt-6 pb-5 px-4 md:px-6">
        <div class="flex justify-content-between">
          <div class="flex flex-column">
            <div class="flex">
              <h2 class="m-0 mb-2 mr-3">{{ principalTitle }}</h2>
              <i
                class="fa-solid fa-circle-info"
                style="font-size: 24px"
                (click)="toggleInfo()"
                onkeypress
              ></i>
            </div>

            <p class="body3 mt-2 mr-3">
              Por favor complete la información para
              {{ principalTitle === "Crear membresía" ? "crear" : "modificar" }}
              una membresía
            </p>
          </div>
          <i
            class="fa-solid fa-xmark cursor-pointer"
            style="font-size: 24px"
            (click)="modalCreate = false"
            onkeypress
          ></i>
        </div>
      </div>
      <div class="pb-4 px-4 md:px-6">
        <div *ngIf="showInfo" class="mb-4 flex flex-column">
          <p-panel
            header="Descuenta por Asistencia y Duración"
            [toggleable]="false"
          >
            <p>
              Esta modalidad se aplica para tiqueteras. Cada vez que el socio
              asiste a una clase, se deduce automáticamente una sesión de su
              tiquetera si utiliza el control de acceso. Si no es así, los
              administradores pueden realizar esta deducción de manera manual.
              Si el socio no asiste a todas las clases disponibles antes de la
              fecha de vencimiento, las sesiones restantes se considerarán
              consumidas.
            </p>
          </p-panel>
          <p-panel
            header="Únicamente por Duración"
            [toggleable]="false"
            class="mt-2"
          >
            <p>
              En este caso, la membresía se basa exclusivamente en el tiempo,
              sin considerar la asistencia.
            </p>
          </p-panel>
          <p-panel header="Ilimitado" [toggleable]="false" class="mt-2">
            <p>
              Esta modalidad otorga el derecho a formar parte del gimnasio y no
              restringe el control de acceso (Únicamente administradores).
            </p>
          </p-panel>
        </div>
        <form class="grid font-bold" [formGroup]="merbershipForm">
          <div class="field col-12 py-0">
            <label for="name">Nombre*</label>
            <input
              id="name"
              type="text"
              maxlength="100"
              placeholder="Escribe"
              class="w-full p-inputtext"
              [(ngModel)]="newMembership.name"
              formControlName="name"
              [ngClass]="{ 'ng-invalid ng-dirty': isInvalid('name') }"
              pInputText
            />
            <small *ngIf="isInvalid('name')" class="p-error font-normal block"
              ><i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>

          <div class="field col-12 py-0">
            <label for="membershipTypeId">Modalidad*</label>
            <p-dropdown
              id="membershipTypeId"
              [options]="listTypes"
              optionLabel="membershipTypeName"
              optionValue="membershipTypeId"
              [style]="{ width: '100%' }"
              [(ngModel)]="newMembership.membershipTypeId"
              placeholder="Selecciona"
              formControlName="membershipTypeId"
              [ngClass]="{
                'ng-invalid ng-dirty': isInvalid('membershipTypeId')
              }"
              appendTo="body"
              (ngModelChange)="setType()"
            ></p-dropdown>
            <small
              *ngIf="isInvalid('membershipTypeId')"
              class="p-error font-normal block"
            >
              <i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>

          <div
            *ngIf="newMembership.membershipTypeId === 1"
            class="field col-12 md:col-6 py-0 pr-2 lg:pr-5"
          >
            <label for="cantSessions">Cantidad de sesiones*</label>
            <p-inputNumber
              pInputNumber
              id="cantSessions"
              [max]="99999999"
              [maxFractionDigits]="0"
              placeholder="Escribe"
              class="w-full"
              [style]="{ width: '100%' }"
              [(ngModel)]="newMembership.cantSessions"
              formControlName="cantSessions"
              [ngClass]="{ 'ng-invalid ng-dirty': isInvalid('cantSessions') }"
            ></p-inputNumber>
            <small
              *ngIf="isInvalid('cantSessions')"
              class="p-error font-normal block"
            >
              <i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>

          <div
            *ngIf="
              newMembership.membershipTypeId === 1 ||
              newMembership.membershipTypeId === 2
            "
            class="field col-12 md:col-6 py-0"
          >
            <label for="price">Precio*</label>
            <p-inputNumber
              pInputNumber
              id="price"
              [max]="99999999"
              [maxFractionDigits]="0"
              placeholder="Escribe"
              class="w-full"
              [style]="{ width: '100%' }"
              [(ngModel)]="newMembership.price"
              formControlName="price"
              [ngClass]="{ 'ng-invalid ng-dirty': isInvalid('price') }"
            ></p-inputNumber>
            <small *ngIf="isInvalid('price')" class="p-error font-normal block"
              ><i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>

          <div
            *ngIf="
              newMembership.membershipTypeId === 1 ||
              newMembership.membershipTypeId === 2
            "
            class="field col-12 md:col-6 py-0"
            [ngClass]="{ 'pr-2 lg:pr-5': newMembership.membershipTypeId === 1 }"
          >
            <label for="expiresId">Vencimiento*</label>
            <p-dropdown
              id="expiresId"
              [options]="listExpires"
              optionLabel="expiresName"
              optionValue="expiresId"
              [style]="{ width: '100%' }"
              [(ngModel)]="newMembership.expiresId"
              placeholder="Selecciona"
              formControlName="expiresId"
              [ngClass]="{ 'ng-invalid ng-dirty': isInvalid('expiresId') }"
              appendTo="body"
            ></p-dropdown>
            <small
              *ngIf="isInvalid('expiresId')"
              class="p-error font-normal block"
              ><i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>
        </form>
      </div>
    </div>

    <div class="lines"></div>
    <div class="flex flex-wrap-reverse my-4 justify-content-center gap-1">
      <p-button
        class="flex p-button-outlined mr-0 md:mr-1 lg:mr-3"
        styleClass="p-button-outlined"
        label="Atrás"
        [style]="{ width: '260px' }"
        (onClick)="goBack()"
      ></p-button>
      <p-button
        class="flex"
        label="{{
          newMembership.id !== undefined
            ? 'Modificar membresía'
            : 'Crear membresía'
        }}"
        [style]="{ width: '260px' }"
        [disabled]="!this.merbershipForm.valid"
        (onClick)="createMembership()"
      ></p-button>
    </div>
  </ng-template>
</g-modal>
<!-- Crear membresia -->

<div class="mt-2">
  <div
    class="flex justify-content-between align-items-center flex-wrap mt-3 gap-2"
  >
    <g-title title="Usuarios" style="margin-top: -1rem"></g-title>
    <div class="flex">
      <p-button
        label="Crear usuario"
        borderRadius="10px"
        icon="ml-4 fa-solid fa-id-card-clip"
        (onClick)="createNewUsuario()"
      ></p-button>
    </div>
  </div>
  <div class="container py-2 mt-4 mb-5 px-3 md:px-5">
    <!-- Details -->
    <div class="flex flex-wrap mt-2 justify-content-between align-items-end">
      <div class="flex" style="width: 420px">
        <span class="p-input-icon-left w-full">
          <i class="pi pi-search"></i>
          <input
            pInputText
            pAutoFocus
            class="p-inputtext w-full"
            [style]="{ height: '48px' }"
            [autofocus]="true"
            placeholder="Buscar por nombre de usuario..."
            paddingLeft="35px"
            [(ngModel)]="userFilter"
            (input)="applyFilterUser(userFilter!)"
            maxLength="maxlengthFilter"
          />
        </span>
      </div>
      <!-- Filter -->
      <div class="flex mt-1 w-full sm:w-auto">
        <g-filter
          class="w-full sm:w-auto"
          [listStatus]="listStatus"
          [statusFilter]="statusFilter"
          [listTypes]="listTypes"
          [typesFilter]="typesFilter"
          [labelFiltro]="labelFiltro"
          (selectedStatus)="statusFilter = $event"
          (selectedTypes)="typesFilter = $event"
          (apply)="applyFilter()"
          (clean)="cleanFilter()"
        ></g-filter>
      </div>
    </div>

    <div class="mt-3">
      <div class="grid">
        <div *ngFor="let user of listUser" class="col lg:col-6">
          <g-card-user
            [data]="user"
            (clickEmiter)="openDetail(user.id!)"
            (mouseenter)="hover = true"
            (mouseleave)="hover = false"
            [hover]="hover"
            onkeypress
          ></g-card-user>
        </div>
      </div>
      <div class="mt-5">
        <p-paginator
          (onPageChange)="onPageChange($event)"
          [styleClass]="'noBorder'"
          [first]="first"
          [rows]="rows"
          [totalRecords]="totalElements"
          [rowsPerPageOptions]="[10, 20, 50]"
          [showCurrentPageReport]="true"
          [currentPageReportTemplate]="currentPageReportTemplate"
        />
      </div>
    </div>
  </div>
</div>

<!-- Crear usuario -->
<g-modal
  [show]="modalCreate"
  [closeOnEscape]="false"
  [showCloseIcon]="false"
  [showHeader]="false"
  [width]="'780px'"
>
  <ng-template pTemplate="content">
    <div>
      <div class="pt-6 pb-5 px-4 md:px-6">
        <div class="flex justify-content-between">
          <div class="flex flex-column">
            <h2 class="m-0 mb-2">{{ principalTitle }}</h2>
            <p class="body3 mt-2 mr-3">
              Por favor complete la información para
              {{ principalTitle === "Crear usuario" ? "crear" : "modificar" }}
              un usuario
            </p>
          </div>
          <i
            class="fa-solid fa-xmark cursor-pointer"
            style="font-size: 24px"
            (click)="modalCreate = false"
            onkeypress
          ></i>
        </div>
      </div>
      <div class="pb-4 px-4 md:px-6">
        <form class="grid font-bold" [formGroup]="userForm">
          <div class="field col-12 py-0">
            <label for="name">Nombre*</label>
            <input
              id="name"
              type="text"
              maxlength="100"
              placeholder="Escribe"
              class="w-full p-inputtext"
              [(ngModel)]="newUser.name"
              formControlName="name"
              [ngClass]="{ 'ng-invalid ng-dirty': isInvalid('name') }"
              pInputText
            />
            <small *ngIf="isInvalid('name')" class="p-error font-normal block"
              ><i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>
          <div class="field col-12 py-0">
            <label for="email">Correo electrónico*</label>
            <input
              id="email"
              type="email"
              maxlength="100"
              placeholder="Escribe"
              class="w-full p-inputtext"
              [(ngModel)]="newUser.email"
              formControlName="email"
              [ngClass]="{ 'ng-invalid ng-dirty': isInvalid('email') }"
              pInputText
            />
            <small *ngIf="isInvalid('email')" class="p-error block"
              ><i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>
          <div class="field col-12 md:col-6 pr-2 md:pr-3 py-0">
            <label for="password">Contraseña*</label>
            <input
              id="password"
              type="password"
              maxlength="20"
              placeholder="Escribe"
              class="w-full p-inputtext"
              [(ngModel)]="newUser.password"
              formControlName="password"
              [ngClass]="{ 'ng-invalid ng-dirty': isInvalid('password') }"
              pInputText
            />
            <small *ngIf="isInvalid('password')" class="p-error block"
              ><i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>
          <div class="field col-12 md:col-6 py-0">
            <label for="confirmPassword">Confirmar contraseña*</label>
            <input
              id="confirmPassword"
              type="password"
              maxlength="20"
              placeholder="Escribe"
              class="w-full p-inputtext"
              [(ngModel)]="confirmPassword"
              formControlName="confirmPassword"
              [ngClass]="{
                'ng-invalid ng-dirty': isInvalid('confirmPassword')
              }"
              pInputText
            />
            <small *ngIf="isInvalid('confirmPassword')" class="p-error block"
              ><i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>

          <div class="field col-12 py-0">
            <label for="rolId">Rol*</label>
            <p-dropdown
              id="rolId"
              [options]="listRoles"
              optionLabel="name"
              optionValue="id"
              [style]="{ width: '100%' }"
              [(ngModel)]="newUser.userRoles[0].role.id"
              placeholder="Selecciona"
              formControlName="rolId"
              [ngClass]="{
                'ng-invalid ng-dirty': isInvalid('rolId')
              }"
              appendTo="body"
            ></p-dropdown>
            <small *ngIf="isInvalid('rolId')" class="p-error font-normal block">
              <i class="pi pi-info-circle mr-2"></i>{{ errorText }}
            </small>
          </div>
        </form>
      </div>
    </div>

    <div class="lines"></div>
    <div class="flex flex-wrap-reverse my-4 pt-1 justify-content-center gap-1">
      <p-button
        class="flex p-button-outlined mr-0 md:mr-1 lg:mr-3"
        styleClass="p-button-outlined"
        label="Atrás"
        [style]="{ width: '260px' }"
        (onClick)="goBack()"
      ></p-button>
      <p-button
        class="flex"
        label="{{
          newUser.id !== undefined ? 'Modificar usuario' : 'Crear usuario'
        }}"
        [style]="{ width: '260px' }"
        [disabled]="!this.userForm.valid"
        (onClick)="createUser()"
      ></p-button>
    </div>
  </ng-template>
</g-modal>
<!-- Crear usuario -->

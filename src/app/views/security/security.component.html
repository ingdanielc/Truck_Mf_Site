<div class="security-container py-4 px-3 px-md-5">
  <!-- Header Section -->
  <header class="row align-items-center g-3 mb-4 mb-md-5 gx-0">
    <div class="col-12 col-md">
      <h1 class="display-6 fw-bold mb-1">Listado de Usuarios</h1>
      <p class="text-secondary mb-0">
        Gestión centralizada de usuarios para conductores y propietarios
      </p>
    </div>
    <div class="col-12 col-md-auto d-grid d-md-block">
      <button
        class="btn btn-primary d-flex align-items-center justify-content-center px-4 py-2 rounded-3 shadow-primary"
        (click)="toggleOffcanvas()"
      >
        <i class="fa-solid fa-user-plus me-2"></i>Nuevo Usuario
      </button>
    </div>
  </header>

  <!-- Search and Filters Section -->
  <div class="row align-items-center mb-4 g-3">
    <div class="col-12 col-lg-7">
      <div class="search-wrapper position-relative">
        <i
          class="fa-solid fa-search position-absolute top-50 start-0 translate-middle-y ms-3 text-secondary"
        ></i>
        <input
          type="text"
          class="form-control ps-5 py-3 rounded-3"
          placeholder="Buscar por nombre, email o ID..."
        />
      </div>
    </div>
    <div class="col-12 col-lg-5 d-flex justify-content-lg-end">
      <div class="filter-pills p-1 rounded-3">
        @for (filter of filters; track filter) {
          <button
            class="btn btn-sm px-4 py-2 rounded-2 transition-all"
            [class.active]="activeFilter === filter"
            (click)="setFilter(filter)"
          >
            {{ filter }}
          </button>
        }
      </div>
    </div>
  </div>

  <!-- Users Grid -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-5">
    @for (user of users; track user.id) {
      <div class="col">
        <g-card-user [user]="user"></g-card-user>
      </div>
    }
  </div>

  <hr class="op-10 mb-4" />

  <!-- Footer Section -->
  <footer class="row align-items-center g-3">
    <div class="col">
      <p class="text-secondary small mb-0">Mostrando 6 de 128 usuarios</p>
    </div>
    <div class="col-auto d-flex gap-2">
      <button
        class="btn btn-outline-secondary px-3 py-2 rounded-3 small fw-bold"
      >
        Anterior
      </button>
      <button
        class="btn btn-outline-secondary px-3 py-2 rounded-3 small fw-bold"
      >
        Siguiente
      </button>
    </div>
  </footer>

  <!-- Create User Offcanvas -->
  <div
    class="custom-offcanvas shadow-lg border-start transition-all"
    [class.open]="isOffcanvasOpen"
  >
    <div class="offcanvas-header p-4 pb-0 d-flex justify-content-between">
      <div>
        <h2 class="h4 fw-bold mb-1">Crear usuario</h2>
        <p class="text-secondary small">
          Por favor complete la información para crear un usuario
        </p>
      </div>
      <button
        class="btn btn-link text-body p-0 border-0 shadow-none op-70 hover-op-100"
        (click)="toggleOffcanvas()"
      >
        <i class="fa-solid fa-xmark fs-4"></i>
      </button>
    </div>

    <div class="offcanvas-body p-4 pt-4">
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <div class="mb-4">
          <label class="form-label small fw-bold mb-2">Nombre*</label>
          <div class="input-group">
            <input
              type="text"
              class="form-control rounded-3 py-2 px-3"
              formControlName="name"
              placeholder="Escribe"
              [class.is-invalid]="
                userForm.get('name')?.invalid && userForm.get('name')?.touched
              "
            />
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label small fw-bold mb-2"
            >Correo electrónico*</label
          >
          <div class="input-group">
            <input
              type="email"
              class="form-control rounded-3 py-2 px-3"
              formControlName="email"
              placeholder="Escribe"
              [class.is-invalid]="
                userForm.get('email')?.invalid && userForm.get('email')?.touched
              "
            />
          </div>
        </div>

        <div class="row g-3 mb-3">
          <div class="col-6">
            <label class="form-label small fw-bold mb-2">Contraseña*</label>
            <div class="input-group position-relative">
              <input
                type="password"
                class="form-control rounded-3 py-2 px-3 pe-5"
                formControlName="password"
                placeholder="Escribe"
                [class.is-invalid]="
                  userForm.get('password')?.invalid &&
                  userForm.get('password')?.touched
                "
              />
              <i
                class="fa-solid fa-ellipsis position-absolute top-50 end-0 translate-middle-y me-3 text-secondary op-50"
              ></i>
            </div>
          </div>
          <div class="col-6">
            <label class="form-label small fw-bold mb-2"
              >Confirmar contraseña*</label
            >
            <div class="input-group position-relative">
              <input
                type="password"
                class="form-control rounded-3 py-2 px-3 pe-5"
                formControlName="confirmPassword"
                placeholder="Escribe"
                [class.is-invalid]="
                  userForm.hasError('mismatch') &&
                  userForm.get('confirmPassword')?.touched
                "
              />
              <i
                class="fa-solid fa-ellipsis position-absolute top-50 end-0 translate-middle-y me-3 text-secondary op-50"
              ></i>
            </div>
          </div>
        </div>

        <!-- Password Strength Meter -->
        <div class="password-strength-wrapper mb-4">
          <div class="d-flex gap-2 mb-2">
            <div
              class="strength-segment flex-fill"
              [class.active]="strength >= 1"
            ></div>
            <div
              class="strength-segment flex-fill"
              [class.active]="strength >= 2"
            ></div>
            <div
              class="strength-segment flex-fill"
              [class.active]="strength >= 3"
            ></div>
            <div
              class="strength-segment flex-fill"
              [class.active]="strength >= 4"
            ></div>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="small text-secondary fw-bold op-70"
              >Seguridad de contraseña</span
            >
            <span class="small fw-bold text-primary">{{ strengthLabel }}</span>
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label small fw-bold mb-2">Rol*</label>
          <select
            class="form-select rounded-3 py-2 px-3"
            formControlName="role"
            [class.is-invalid]="
              userForm.get('role')?.invalid && userForm.get('role')?.touched
            "
          >
            <option value="" disabled selected>Selecciona</option>
            @for (role of availableRoles; track role) {
              <option [value]="role">{{ role }}</option>
            }
          </select>
        </div>

        <div class="offcanvas-footer border-top pt-4 mt-auto d-flex gap-3">
          <button
            type="button"
            class="btn btn-outline-primary flex-fill py-2 rounded-3 fw-bold"
            (click)="toggleOffcanvas()"
          >
            Atrás
          </button>
          <button
            type="submit"
            class="btn btn-primary flex-fill py-2 rounded-3 fw-bold shadow-primary"
            [disabled]="userForm.invalid"
          >
            Crear usuario
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Backdrop -->
  <div
    class="offcanvas-backdrop transition-all d-none d-md-block"
    *ngIf="isOffcanvasOpen"
    (click)="toggleOffcanvas()"
    onkeypress
  ></div>
</div>

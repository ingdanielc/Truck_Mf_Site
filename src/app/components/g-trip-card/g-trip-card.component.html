<div
  class="card trip-card border-0 rounded-4 shadow-sm h-100 bg-body-tertiary cursor-pointer hover-scale"
  (click)="navigateToDetail()"
  onkeypress
>
  <div class="card-body p-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="trip-id">
        <p
          class="text-body-secondary small fw-bold mb-1 text-uppercase tracking-wider"
        >
          Viaje NÂº
        </p>
        <h3 class="fw-bold mb-0 text-body">
          {{ trip.numberTrip || trip.manifestNumber }}
        </h3>
      </div>
      <span
        class="badge rounded-pill px-3 py-2 status-badge fw-bold"
        [ngClass]="getStatusClass(trip.status)"
      >
        {{ trip.status }}
      </span>
    </div>

    <!-- Vehicle & Driver info -->
    <div
      class="d-flex align-items-center gap-3 mb-3 bg-body-secondary bg-opacity-50 p-3 rounded-4"
    >
      <div class="d-flex align-items-center gap-2 border-end pe-3">
        <i class="fa-solid fa-truck text-primary"></i>
        <div class="d-flex flex-column">
          <span class="small opacity-50 fw-bold text-uppercase">Placa</span>
          <span class="small fw-bold">{{
            trip.vehicle?.plate || trip.vehiclePlate || "N/A"
          }}</span>
        </div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <i class="fa-solid fa-user-tie text-primary"></i>
        <div class="d-flex flex-column">
          <span class="small opacity-50 fw-bold text-uppercase">Conductor</span>
          <span class="small fw-bold text-truncate" style="max-width: 130px">{{
            trip.driver?.name || "N/A"
          }}</span>
        </div>
      </div>
    </div>

    <!-- Route Timeline -->
    <div class="route-timeline mb-3">
      <div class="timeline-item d-flex gap-3 pb-3">
        <div class="timeline-visual position-relative">
          <div class="dot dot-origin bg-primary border-0"></div>
          <div class="line dashed-line position-absolute h-100"></div>
        </div>
        <div class="timeline-content overflow-hidden">
          <p class="text-body-secondary small fw-bold mb-0 text-uppercase">
            Partida
          </p>
          <p class="text-body fw-bold mb-0 text-truncate">{{ originName }}</p>
        </div>
      </div>
      <div class="timeline-item d-flex gap-3">
        <div class="timeline-visual">
          <div class="dot dot-destination border border-primary border-2"></div>
        </div>
        <div class="timeline-content overflow-hidden">
          <p class="text-body-secondary small fw-bold mb-0 text-uppercase">
            Destino
          </p>
          <p class="text-body fw-bold mb-0 text-truncate">
            {{ destinationName }}
          </p>
        </div>
      </div>
    </div>

    <hr class="op-10 mb-3" />

    <!-- Financial Information -->
    <div class="financials mb-1">
      <div class="row align-items-end mb-3">
        <div class="col-7">
          <p class="text-body-secondary small fw-bold mb-1 text-uppercase">
            Flete
          </p>
          <h2 class="h3 fw-bold mb-0 text-body">
            {{ displayFreight | currency: "COP" : "symbol" : "1.0-0" }}
          </h2>
        </div>
        <div class="col-5 text-end">
          <p
            class="text-body-secondary small fw-bold mb-1 text-uppercase tracking-wider"
          >
            Manifiesto
          </p>
          <p class="fw-bold mb-0 text-body op-80">{{ trip.manifestNumber }}</p>
        </div>
      </div>

      <!-- Payment Progress -->
      <div class="payment-progress">
        <div class="d-flex justify-content-between mb-2">
          <span class="small text-body-secondary fw-bold op-70"
            >Anticipo:
            {{ displayAdvance | currency: "COP" : "symbol" : "1.0-0" }}</span
          >
          <span class="small text-primary fw-bold"
            >Saldo:
            {{ displayBalance | currency: "COP" : "symbol" : "1.0-0" }}</span
          >
        </div>
        <div
          class="progress rounded-pill bg-body-secondary"
          style="height: 10px"
        >
          <div
            class="progress-bar rounded-pill bg-primary"
            role="progressbar"
            [style.width.%]="progressPercentage"
            [attr.aria-valuenow]="progressPercentage"
            aria-valuemin="0"
            aria-valuemax="100"
          ></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div
    class="card-footer bg-transparent border-0 p-4 pt-0 d-flex justify-content-between align-items-center mt-auto"
  >
    <div
      class="trip-date d-flex align-items-center text-body-secondary small gap-2"
    >
      <i class="fa-regular fa-calendar"></i>
      <span>{{ trip.startDate | date: "dd MMM, yyyy" }}</span>
    </div>
    <button
      class="btn btn-link text-primary p-0 text-decoration-none fw-bold small d-flex align-items-center gap-2"
      (click)="onEditClick($event)"
    >
      Detalles <i class="fa-solid fa-arrow-right"></i>
    </button>
  </div>
</div>

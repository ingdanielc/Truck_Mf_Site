<div class="password-card-container">
  <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
    <!-- Current Password -->
    <div class="mb-4">
      <label for="currentPassword" class="form-label small fw-bold mb-2"
        >Contraseña actual*</label
      >
      <div
        class="input-group border rounded-3 overflow-hidden bg-body-tertiary"
      >
        <input
          [type]="showCurrentPassword ? 'text' : 'password'"
          class="form-control border-0 bg-transparent py-2 px-3"
          formControlName="currentPassword"
          placeholder="••••••••"
        />
        <button
          class="btn btn-link text-secondary border-0 shadow-none py-2 px-3"
          type="button"
          (click)="toggleVisibility('current')"
          [attr.aria-label]="
            showCurrentPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'
          "
        >
          <i
            class="fa-solid"
            [class.fa-eye]="!showCurrentPassword"
            [class.fa-eye-slash]="showCurrentPassword"
          ></i>
        </button>
      </div>
      @if (
        passwordForm.get("currentPassword")?.invalid &&
        passwordForm.get("currentPassword")?.touched
      ) {
        <div class="text-danger small mt-1">
          La contraseña actual es requerida.
        </div>
      }
    </div>

    <!-- New Password -->
    <div class="mb-4">
      <label for="newPassword" class="form-label small fw-bold mb-2"
        >Nueva contraseña*</label
      >
      <div
        class="input-group border rounded-3 overflow-hidden bg-body-tertiary mb-2"
      >
        <input
          [type]="showNewPassword ? 'text' : 'password'"
          class="form-control border-0 bg-transparent py-2 px-3"
          formControlName="newPassword"
          placeholder="Nueva contraseña"
        />
        <button
          class="btn btn-link text-secondary border-0 shadow-none py-2 px-3"
          type="button"
          (click)="toggleVisibility('new')"
          [attr.aria-label]="
            showNewPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'
          "
        >
          <i
            class="fa-solid"
            [class.fa-eye]="!showNewPassword"
            [class.fa-eye-slash]="showNewPassword"
          ></i>
        </button>
      </div>

      <!-- Strength Meter -->
      <div class="password-strength-meter mb-2">
        <div class="d-flex gap-1">
          <div
            class="strength-bar flex-fill flex-grow-1"
            [class.active-weak]="strength >= 1"
          ></div>
          <div
            class="strength-bar flex-fill flex-grow-1"
            [class.active-medium]="strength >= 2"
          ></div>
          <div
            class="strength-bar flex-fill flex-grow-1"
            [class.active-good]="strength >= 3"
          ></div>
          <div
            class="strength-bar flex-fill flex-grow-1"
            [class.active-strong]="strength >= 4"
          ></div>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-2">
          <span class="small text-secondary fw-bold opacity-75"
            >Seguridad de contraseña</span
          >
          <span class="small fw-bold text-primary">{{ strengthLabel }}</span>
        </div>
      </div>
      @if (
        passwordForm.get("newPassword")?.invalid &&
        passwordForm.get("newPassword")?.touched
      ) {
        <div class="text-danger small mt-1">
          La nueva contraseña debe tener al menos 8 caracteres.
        </div>
      }
    </div>

    <!-- Confirm Password -->
    <div class="mb-5">
      <label for="confirmPassword" class="form-label small fw-bold mb-2"
        >Confirmar nueva contraseña*</label
      >
      <div
        class="input-group border rounded-3 overflow-hidden bg-body-tertiary"
      >
        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          class="form-control border-0 bg-transparent py-2 px-3"
          formControlName="confirmPassword"
          placeholder="Confirmar contraseña"
        />
        <button
          class="btn btn-link text-secondary border-0 shadow-none py-2 px-3"
          type="button"
          (click)="toggleVisibility('confirm')"
          [attr.aria-label]="
            showConfirmPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'
          "
        >
          <i
            class="fa-solid"
            [class.fa-eye]="!showConfirmPassword"
            [class.fa-eye-slash]="showConfirmPassword"
          ></i>
        </button>
      </div>
      @if (
        passwordForm.hasError("mismatch") &&
        passwordForm.get("confirmPassword")?.touched
      ) {
        <div class="text-danger small mt-1">Las contraseñas no coinciden.</div>
      }
    </div>

    <!-- Actions -->
    <div class="offcanvas-footer border-top pt-4 mt-auto d-flex gap-3">
      <button
        type="button"
        class="btn btn-outline-primary flex-fill py-2 rounded-3 fw-bold"
        (click)="onCancel()"
      >
        Atrás
      </button>
      <button
        type="submit"
        class="btn btn-primary flex-fill py-2 rounded-3 fw-bold shadow-primary text-white"
        [disabled]="passwordForm.invalid"
      >
        Actualizar Contraseña
      </button>
    </div>
  </form>
</div>
